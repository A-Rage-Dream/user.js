// ==/UserScript==
// @name          bilibili视频下载
// @namespace     https://github.com/injahow
// @version       2.0.0
// @description   支持Web、RPC、Blob、Aria等下载方式；支持flv、dash、mp4视频格式；支持下载港区番剧；支持会员下载；支持换源播放，自动切换为高清视频源
// @author        injahow
// @copyright     2021, injahow (https://github.com/injahow)
// @license       MIT
// @source        https://github.com/injahow/user.js
// @supportURL    https://github.com/injahow/user.js/issues
// @downloadURL   https://greasyfork.org/scripts/413228-bilibili%E8%A7%86%E9%A2%91%E4%B8%8B%E8%BD%BD/code/bilibili%E8%A7%86%E9%A2%91%E4%B8%8B%E8%BD%BD.user.js
// @updateURL     https://greasyfork.org/scripts/413228-bilibili%E8%A7%86%E9%A2%91%E4%B8%8B%E8%BD%BD/code/bilibili%E8%A7%86%E9%A2%91%E4%B8%8B%E8%BD%BD.user.js
// @match         *://www.bilibili.com/video/av*
// @match         *://www.bilibili.com/video/BV*
// @match         *://www.bilibili.com/medialist/play/*
// @match         *://www.bilibili.com/bangumi/play/ep*
// @match         *://www.bilibili.com/bangumi/play/ss*
// @match         *://www.bilibili.com/cheese/play/ep*
// @match         *://www.bilibili.com/cheese/play/ss*
// @match         https://www.mcbbs.net/template/mcbbs/image/special_photo_bg.png*
// @require       https://static.hdslb.com/js/jquery.min.js
// @require       https://cdn.jsdelivr.net/npm/flv.js@1.6.2/dist/flv.min.js
// @require       https://cdn.jsdelivr.net/npm/dplayer@1.26.0/dist/DPlayer.min.js
// @icon          https://static.hdslb.com/images/favicon.ico
// @compatible    chrome
// @compatible    firefox
// @grant         none
// ==/UserScript==
/* eslint-disable */ /* spell-checker: disable */
// @[ You can find all source codes in GitHub repo ]
!function(){"use strict";var e={500:function(e,t,n){var i=n(81),o=n.n(i),a=n(645),r=n.n(a)()(o());r.push([e.id,"#bp_config {\n  opacity: 0;\n  display: none;\n  position: fixed;\n  inset: 0px;\n  top: 0px;\n  left: 0px;\n  width: 100%;\n  height: 100%;\n  z-index: 10000;\n}\n.bp_config_bg {\n  position: absolute;\n  background: rgb(255, 255, 255);\n  border-radius: 10px;\n  padding: 20px;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  width: 600px;\n  box-shadow: rgb(0 0 0 / 70%) 0px 0px 0px 1000px;\n}\n.setting-button {\n  width: 120px;\n  height: 40px;\n  border-width: 0px;\n  border-radius: 3px;\n  background: #1e90ff;\n  cursor: pointer;\n  outline: none;\n  color: white;\n  font-size: 17px;\n}\n.setting-button:hover {\n  background: #5599ff;\n}\n.setting-context {\n  margin: 0 1%;\n  color: blue;\n}\n.setting-context:hover {\n  color: red;\n}\n",""]),t.Z=r},88:function(e,t,n){var i=n(81),o=n.n(i),a=n(645),r=n.n(a)()(o());r.push([e.id,".message-bg {\n  position: fixed;\n  float: right;\n  right: 0;\n  top: 2%;\n  z-index: 30000;\n}\n.message {\n  margin-bottom: 15px;\n  padding: 2% 2%;\n  width: 300px;\n  display: flex;\n  margin-top: -70px;\n  opacity: 0;\n}\n.message-success {\n  background-color: #ddffdd;\n  border-left: 6px solid #4caf50;\n}\n.message-danger {\n  background-color: #ffdddd;\n  border-left: 6px solid #f44336;\n}\n.message-info {\n  background-color: #e7f3fe;\n  border-left: 6px solid #0c86de;\n}\n.message-warning {\n  background-color: #ffffcc;\n  border-left: 6px solid #ffeb3b;\n}\n.message-context {\n  font-size: 21px;\n  word-wrap: break-word;\n  word-break: break-all;\n}\n.message-context p {\n  margin: 0;\n}\n\n#message_box {\n  opacity: 0;\n  display: none;\n  position: fixed;\n  inset: 0px;\n  top: 0px;\n  left: 0px;\n  width: 100%;\n  height: 100%;\n  z-index: 20000;\n}\n.message_box_bg {\n  position: absolute;\n  background: rgb(255, 255, 255);\n  border-radius: 10px;\n  padding: 20px;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  width: 400px;\n  box-shadow: rgb(0 0 0 / 70%) 0px 0px 0px 1000px;\n}\n.message_box_btn {\n  text-align: right;\n}\n.message_box_btn button {\n  margin: 0 5px;\n  width: 120px;\n  height: 40px;\n  border-width: 0px;\n  border-radius: 3px;\n  background: #1e90ff;\n  cursor: pointer;\n  outline: none;\n  color: white;\n  font-size: 17px;\n}\n.message_box_btn button:hover {\n  background: #5599ff;\n}\n",""]),t.Z=r},645:function(e){e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",i=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),i&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),i&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,i,o,a){"string"==typeof e&&(e=[[null,e,void 0]]);var r={};if(i)for(var c=0;c<this.length;c++){var l=this[c][0];null!=l&&(r[l]=!0)}for(var s=0;s<e.length;s++){var d=[].concat(e[s]);i&&r[d[0]]||(void 0!==a&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=a),n&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=n):d[2]=n),o&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=o):d[4]="".concat(o)),t.push(d))}},t}},81:function(e){e.exports=function(e){return e[1]}},379:function(e){var t=[];function n(e){for(var n=-1,i=0;i<t.length;i++)if(t[i].identifier===e){n=i;break}return n}function i(e,i){for(var a={},r=[],c=0;c<e.length;c++){var l=e[c],s=i.base?l[0]+i.base:l[0],d=a[s]||0,u="".concat(s," ").concat(d);a[s]=d+1;var p=n(u),f={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==p)t[p].references++,t[p].updater(f);else{var v=o(f,i);i.byIndex=c,t.splice(c,0,{identifier:u,updater:v,references:1})}r.push(u)}return r}function o(e,t){var n=t.domAPI(t);n.update(e);return function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,o){var a=i(e=e||[],o=o||{});return function(e){e=e||[];for(var r=0;r<a.length;r++){var c=n(a[r]);t[c].references--}for(var l=i(e,o),s=0;s<a.length;s++){var d=n(a[s]);0===t[d].references&&(t[d].updater(),t.splice(d,1))}a=l}}},569:function(e){var t={};e.exports=function(e,n){var i=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(n)}},216:function(e){e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},565:function(e,t,n){e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},795:function(e){e.exports=function(e){var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var i="";n.supports&&(i+="@supports (".concat(n.supports,") {")),n.media&&(i+="@media ".concat(n.media," {"));var o=void 0!==n.layer;o&&(i+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),i+=n.css,o&&(i+="}"),n.media&&(i+="}"),n.supports&&(i+="}");var a=n.sourceMap;a&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(a))))," */")),t.styleTagTransform(i,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},589:function(e){e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}}},t={};function n(i){var o=t[i];if(void 0!==o)return o.exports;var a=t[i]={id:i,exports:{}};return e[i](a,a.exports,n),a.exports}n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var t=new(function(){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.prefix="bp_"}var n,i,o;return n=t,(i=[{key:"get",value:function(e){return localStorage.getItem(this.prefix+(e||""))||""}},{key:"set",value:function(e,t){return localStorage.setItem(this.prefix+(e||""),t)}}])&&e(n.prototype,i),o&&e(n,o),Object.defineProperty(n,"prototype",{writable:!1}),t}());function i(){return location.pathname.match("/cheese/play/")?"cheese":location.pathname.match("/medialist/play/")?"medialist":window.__INITIAL_STATE__?window.__INITIAL_STATE__.epInfo?"bangumi":window.__INITIAL_STATE__.videoData?"video":void 0:"?"}var o={"1080P 高码率":112,"1080P 高清":80,"720P 高清":64,"480P 清晰":32,"360P 流畅":16,"自动":64};var a={type:i,base:function(){var e=i();if("video"===e){var t=window.__INITIAL_STATE__;return{type:"video",total:function(){return t.videoData.pages.length||1},title:function(e){var n=e||t.p||1;return(t.videoData.pages[n-1].part||"unknown").replace(/[\/\\:*?"<>|]+/g,"")},filename:function(e){var n=e||t.p||1;return((t.videoData&&t.videoData.title||"unknown")+" P".concat(n," （").concat(t.videoData.pages[n-1].part||n,"）")).replace(/[\/\\:*?"<>|]+/g,"")},aid:function(e){return t.videoData.aid},p:function(){return t.p||1},cid:function(e){var n=e||t.p||1;return t.videoData.pages[n-1].cid},epid:function(e){return""},need_vip:function(){return!1},vip_need_pay:function(){return!1},is_limited:function(){return!1}}}if("medialist"===e){var n=$("div.player-auxiliary-playlist-item"),o=$("div.player-auxiliary-playlist-item.player-auxiliary-playlist-item-active").index(),a=$(".player-auxiliary-playlist-top .player-auxiliary-filter-title").html();return{type:"video",total:function(){return n.length},title:function(e){var t=e?e-1:o,i=n.eq(t).find(".player-auxiliary-playlist-item-title").attr("title")||"unknown";return i.replace(/[\/\\:*?"<>|]+/g,"")},filename:function(e){var t=e?e-1:o,i=n.eq(t).find(".player-auxiliary-playlist-item-title").attr("title")||"unknown";return"".concat(a," P").concat(t+1," （").concat(i,"）").replace(/[\/\\:*?"<>|]+/g,"")},aid:function(e){var t=e?e-1:o;return n.eq(t).attr("data-aid")},p:function(){return o+1},cid:function(e){var t=e?e-1:o;return n.eq(t).attr("data-cid")},epid:function(e){return""},need_vip:function(){return!1},vip_need_pay:function(){return!1},is_limited:function(){return!1}}}if("bangumi"===e){var r=window.__INITIAL_STATE__;return{type:"bangumi",total:function(){return r.epList.length},title:function(e){var t=e?r.epList[e-1]:r.epInfo;return("".concat(t.titleFormat," ").concat(t.longTitle)||"unknown").replace(/[\/\\:*?"<>|]+/g,"")},filename:function(e){if(e){var t=r.epList[e-1];return("".concat(r.mediaInfo.season_title,"：").concat(t.titleFormat," ").concat(t.longTitle)||"unknown").replace(/[\/\\:*?"<>|]+/g,"")}return(r.h1Title||"unknown").replace(/[\/\\:*?"<>|]+/g,"")},aid:function(e){return e?r.epList[e-1].aid:r.epInfo.aid},p:function(){return r.epInfo.i||1},cid:function(e){return e?r.epList[e-1].cid:r.epInfo.cid},epid:function(e){return e?r.epList[e-1].id:r.epInfo.id},need_vip:function(){return"会员"===r.epInfo.badge},vip_need_pay:function(){return r.epPayMent.vipNeedPay},is_limited:function(){return r.userState.areaLimit}}}if("cheese"===e){var c=(location.href.match(/\/cheese\/play\/ep(\d+)/i)||["",""])[1];window.bp_episodes||(window.bp_episodes=[],le.get_season(c));var l=window.bp_episodes,s=$("li.on.list-box-li").index();return{type:"cheese",total:function(){return l.length},title:function(e){return(l[e?e-1:s].title||"unknown").replace(/[\/\\:*?"<>|]+/g,"")},filename:function(e){var t=e?e-1:s;return"".concat($("div.season-info h1").html()," P").concat(t+1," （").concat(l[t].title||"unknown","）").replace(/[\/\\:*?"<>|]+/g,"")},aid:function(e){return l[e?e-1:s].aid},p:function(){return s+1},cid:function(e){return l[e?e-1:s].cid},epid:function(e){return l[e?e-1:s].id},need_vip:function(){return!1},vip_need_pay:function(){return!1},is_limited:function(){return!1}}}return{type:"?",total:function(){return 0},title:function(e){return""},filename:function(e){return""},aid:function(e){return""},p:function(){return 1},cid:function(e){return""},epid:function(e){return""},need_vip:function(){return!1},vip_need_pay:function(){return!1},is_limited:function(){return!1}}},get_quality:function(){var e=0,t=0;return $("li.bui-select-item")[0]&&(t=parseInt($("li.bui-select-item")[0].dataset.value))?e=parseInt($("li.bui-select-item.bui-select-item-active").attr("data-value"))||(t>80?80:t):$("li.squirtle-select-item")[0]&&(t=parseInt($("li.squirtle-select-item")[0].dataset.value))?e=parseInt($("li.squirtle-select-item.active").attr("data-value"))||(t>80?80:t):$("div.edu-player-quality-item")[0]?(e=o[$("div.edu-player-quality-item.active span").text()||"自动"]||80,t=o[$("div.edu-player-quality-item span").text()||"自动"]||80):e=t=80,{q:e,q_max:t}},get_quality_support:function(){var e,t=[];return"cheese"===i()?((e=$("div.edu-player-quality-item span")).each((function(){if("自动"===$(this).text())return!1;t.push(o[$(this).text()])})),t.length?t:["80","64","32","16"]):($("ul.squirtle-select-list")[0]?e=$("li.squirtle-select-item"):$("ul.bui-select-list")[0]&&(e=$("li.bui-select-item")),e&&e.length?(e.each((function(){var e="".concat($(this).attr("data-value"));if("0"===e)return!1;t.push(e)})),t):["80","64","32","16"])}};var r={show:function(){$("div#bp_config").is(":hidden")&&$("div#message_box").is(":hidden")&&$("body").css("overflow","auto")},hide:function(){$("body").css("overflow","hidden")}},c=n(379),l=n.n(c),s=n(795),d=n.n(s),u=n(569),p=n.n(u),f=n(565),v=n.n(f),b=n(216),_=n.n(b),h=n(589),m=n.n(h),y=n(88),g={};g.styleTagTransform=m(),g.setAttributes=v(),g.insert=p().bind(null,"head"),g.domAPI=d(),g.insertStyleElement=_();l()(y.Z,g);var w=y.Z&&y.Z.locals?y.Z.locals:void 0;function k(e,t){"confirm"===t?$('div.message_box_btn button[name="cancel"]').show():"alert"===t&&$('div.message_box_btn button[name="cancel"]').hide(),e.html?$("div#message_box_context").html('<div style="font-size:18px">'.concat(e.html,"</div>")):$("div#message_box_context").html('<div style="font-size:18px">╰(￣▽￣)╮</div>'),r.hide(),$("#message_box").show(),$("div#message_box").animate({opacity:"1"},300),$('div.message_box_btn button[name="affirm"]')[0].onclick=function(){$("div#message_box").hide(),$("div#message_box").css("opacity",0),r.show(),e.callback&&e.callback.affirm&&e.callback.affirm()},$('div.message_box_btn button[name="cancel"]')[0].onclick=function(){$("div#message_box").hide(),$("div#message_box").css("opacity",0),r.show(),e.callback&&e.callback.cancel&&e.callback.cancel()}}var x=0;function F(e,t){(function(e,t){$("div.message-bg").append(e),$("div#message-".concat(t)).animate({"margin-top":"+=70px",opacity:"1"},300)})('<div id="message-'.concat(x+=1,'" class="message message-').concat(t,'"><div class="message-context"><p><strong>').concat(t,"：</strong></p><p>").concat(e,"</p></div></div>"),x),function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;setTimeout((function(){var t="div#message-".concat(e);$(t).animate({"margin-top":"-=70px",opacity:"0"},300,(function(){$(t).remove()}))}),1e3*t)}(x,3)}var T=function(e){return F(e,"success")},S=function(e){return F(e,"warning")},I=function(e){return F(e,"danger")},j=function(e){return F(e,"info")},P=function(e){return F("(^・ω・^)~喵喵喵~","info")},q=function(e,t){return k({html:e,callback:{affirm:t}},"alert")},R=function(e,t,n){return k({html:e,callback:{affirm:t,cancel:n}},"confirm")};function A(e){return new Promise((function(t,n){e.success=function(e){e.code&&S("请求失败，".concat(e.message||"CODE:".concat(e.code))),t(e)},e.error=function(e){I("网络异常"),n(e)},$.ajax(e)}))}function L(e,t){t?A({url:"https://api.bilibili.com/x/v1/dm/list.so?oid=".concat(t),dataType:"text"}).then((function(t){var n=$(t.replace(/[\x00-\x08\x0b-\x0c\x0e-\x1f\x7f]/g,""));if(n)if(n.find("d")[0]){var i=n.find("d").map((function(e,t){var n=$(t),i=n.attr("p").split(","),o=0;return"4"===i[1]?o=2:"5"===i[1]&&(o=1),[{author:"",time:parseFloat(i[0]),type:o,color:parseInt(i[3]),id:"",text:n.text()}]})).get();e.success(i),setTimeout((function(){z()}),100)}else e.error("未发现弹幕");else e.error("弹幕获取失败")})).catch((function(t){e.error("弹幕请求异常")})):e.error("cid未知，无法获取弹幕")}function O(){return $("bwp-video")[0]?"bwp-video":$('video[class!="dplayer-video dplayer-video-current"]')[0]?'video[class!="dplayer-video dplayer-video-current"]':void 0}function C(){var e=$(O())[0];e&&(e.pause(),e.currentTime=0)}function E(){if(window.bp_dplayer){var e=$(O())[0];e&&e.removeEventListener("play",C,!1),window.bp_dplayer.destroy(),window.bp_dplayer=null,$("#bp_dplayer").remove(),window.bp_dplayer_2&&(window.bp_dplayer_2.destroy(),window.bp_dplayer_2=null,$("#bp_dplayer_2").remove()),$($("#bilibiliPlayer")[0]?"#bilibiliPlayer":$("#bilibili-player")[0]?"#bilibili-player":"cheese"===a.type()?$('div.bpx-player[data-injector="nano"]')[0]?'div.bpx-player[data-injector="nano"]':"#pay-mask":void 0).show()}}function z(){var e=""+'<style id="dplayer_danmaku_style">\n        .dplayer-danmaku .dplayer-danmaku-right.dplayer-danmaku-move {\n            animation-duration: '.concat(parseFloat(ne.danmaku_speed),"s;\n            font-size: ").concat(parseInt(ne.danmaku_fontsize),"px;\n        }\n        </style>");$("#dplayer_danmaku_style")[0]&&$("#dplayer_danmaku_style").remove(),$("body").append(e)}var M={bili_video_tag:O,recover_player:E,replace_player:function(e,t){E();var n,i=$(O())[0];C(),i&&i.addEventListener("play",C,!1),$("#bilibiliPlayer")[0]?(n="#bilibiliPlayer",$(n).before('<div id="bp_dplayer" class="bilibili-player relative bilibili-player-no-cursor">'),$(n).hide()):$("#bilibili-player")[0]?(n="#bilibili-player",$(n).before('<div id="bp_dplayer" class="bilibili-player relative bilibili-player-no-cursor" style="width:100%;height:100%;"></div>'),$(n).hide()):"cheese"===a.type()&&($('div.bpx-player[data-injector="nano"]')[0]?($("#pay-mask").hide(),$("#bofqi").show(),n='div.bpx-player[data-injector="nano"]',$(n).before('<div id="bp_dplayer" style="width:100%;height:100%;"></div>'),$(n).hide()):(n="#pay-mask",$(n).html('<div id="bp_dplayer" style="width:100%;height:100%;"></div>'))),$("#player_mask_module").hide(),le.get_subtitle_url(0,(function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(window.bp_dplayer=new DPlayer({container:$("#bp_dplayer")[0],mutex:!1,volume:1,autoplay:!0,video:{url:e,type:"auto"},subtitle:{url:n,type:"webvtt",fontSize:"35px",bottom:"5%",color:"#fff"},danmaku:!0,apiBackend:{read:function(e){L(e,a.base().cid())},send:function(e){e.error("此脚本无法将弹幕同步到云端")}},contextmenu:[{text:"脚本信息",link:"https://github.com/injahow/user.js"},{text:"脚本作者",link:"https://injahow.com"}]}),"dash"===ne.format&&t&&"#"!==t){$("body").append('<div id="bp_dplayer_2" style="display:none;"></div>'),window.bp_dplayer_2=new DPlayer({container:$("#bp_dplayer_2")[0],mutex:!1,volume:1,autoplay:!0,video:{url:t,type:"auto"}});var i=[window.bp_dplayer,window.bp_dplayer_2],o=i[0],r=i[1];o.on("play",(function(){!o.paused&&r.play()})),o.on("playing",(function(){!o.paused&&r.play()})),o.on("timeupdate",(function(){Math.abs(o.video.currentTime-r.video.currentTime)>1&&(r.pause(),r.seek(o.video.currentTime)),!o.paused&&r.play()})),o.on("seeking",(function(){r.pause(),r.seek(o.video.currentTime)})),o.on("waiting",(function(){r.pause(),r.seek(o.video.currentTime)})),o.on("pause",(function(){r.pause(),r.seek(o.video.currentTime)})),o.on("suspend",(function(){r.speed(o.video.playbackRate)})),o.on("volumechange",(function(){r.volume(o.video.volume),r.video.muted=o.video.muted}))}}))},danmaku:{config:z}};function U(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var B=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.aid="",this.cid="",this.q="",this.epid=""}var t,n,i;return t=e,(n=[{key:"refresh",value:function(){console.log("refresh..."),$("#video_download").hide(),$("#video_download_2").hide(),M.recover_player();var e=a.base();this.aid=e.aid(),this.cid=e.cid(),this.epid=e.epid(),this.q=a.get_quality().q,window.bp_episodes=null}}])&&U(t.prototype,n),i&&U(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}());function D(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return N(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return N(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,r=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return r=e.done,e},e:function(e){c=!0,a=e},f:function(){try{r||null==n.return||n.return()}finally{if(c)throw a}}}}function N(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function H(){return ne.rpc_domain.match("https://")||ne.rpc_domain.match(/localhost|127\.0\.0\.1/)?"post":"ariang"}var Z=!1;function J(e){var t="http://ariang.injahow.com/"+(e?"#!/settings/rpc/set/".concat(e.domain.replace("://","/"),"/").concat(e.port,"/jsonrpc/").concat(window.btoa(e.token)):""),n=document.createElement("a");n.setAttribute("target","_blank"),n.setAttribute("onclick","window.bp_aria2_window=window.open('".concat(t,"');")),document.body.appendChild(n),n.click(),n.remove()}var G=!1,V=!0;function W(e,t){if(G)return P(),void(V=!0);var n=new XMLHttpRequest;n.open("get",e),n.responseType="blob",n.onload=function(){if(200===this.status||304===this.status){if("msSaveOrOpenBlob"in navigator)return void navigator.msSaveOrOpenBlob(this.response,t);var e=URL.createObjectURL(this.response),n=document.createElement("a");n.style.display="none",n.href=e,n.download=t,document.body.appendChild(n),n.click(),n.remove(),URL.revokeObjectURL(e)}},V=!0,n.onprogress=function(e){if(4!=this.state){var t=e.loaded,n=e.total;!function(e){var t=e.total,n=e.loaded,i=e.percent;V&&q("文件大小：".concat(Math.floor(t/1048576),"MB(").concat(t,"Byte)<br/>")+"已经下载：".concat(Math.floor(n/1048576),"MB(").concat(n,"Byte)<br/>")+"当前进度：".concat(i,"%<br/>下载中请勿操作浏览器！"),(function(){V=!1,q("注意：刷新或离开页面会导致下载取消！<br/>再次点击下载按钮可查看下载进度。")})),t===n&&(q("下载完成，请等待浏览器保存！"),G=!1)}({total:n,loaded:t,percent:Math.floor(100*t/n)})}},n.send(),G=!0,j("准备开始下载")}function X(e){return e.match(".flv")?".flv":e.match(".m4s")?"_video.mp4":(e.match(".mp4"),".mp4")}var Y={url_format:X,download:function(e,t,n){var i=t.replace(/[\/\\:*?"<>|]+/g,"")+ +X(e);"blob"===n?W(e,i):"rpc"===n&&function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"post";if(Z)P();else{Z=!0;var i={domain:ne.rpc_domain,port:ne.rpc_port,token:ne.rpc_token,dir:ne.rpc_dir},o={id:window.btoa("BParse_".concat(Date.now(),"_").concat(Math.random())),jsonrpc:"2.0",method:"aria2.addUri",params:["token:".concat(i.token),[e],{dir:i.dir,out:t,header:["User-Agent: ".concat(window.navigator.userAgent),"Referer: ".concat(window.location.href)]}]};if(j("发送RPC下载请求"),"post"===n)A({url:"".concat(i.domain,":").concat(i.port,"/jsonrpc"),type:"POST",dataType:"json",data:JSON.stringify(o)}).then((function(e){e.result?T("RPC请求成功"):S("请检查RPC参数")})).catch((function(e){I("请检查RPC服务配置")})).finally((function(e){return Z=!1}));else if("ariang"===n){var a=window.bp_aria2_window,r=100;a&&!a.closed||(J(),r=3e3),setTimeout((function(){var n=window.bp_aria2_window,i="header=User-Agent:".concat(window.navigator.userAgent,"&header=Referer:").concat(window.location.href),o="#!/new/task?url=".concat(window.btoa(e),"&out=").concat(encodeURIComponent(t),"&").concat(i);n&&!n.closed?(n.location.href="http://ariang.injahow.com/".concat(o),T("RPC请求发送成功")):S("AriaNG页面未打开"),Z=!1}),r)}}}(e,i,H())},download_all:function(){var e=a.base(),t=[a.get_quality().q,e.total()],n=t[0],i=t[1];$("body").on("click",'input[name="dl_video"]',(function(){$(this).is(":checked")?$(this).parent().css("color","rgba(0,0,0,1)"):$(this).parent().css("color","rgba(0,0,0,0.5)")}));for(var o="",r=0;r<i;r++)o+=""+'<label for="option_'.concat(r,'"><div style="color:rgba(0,0,0,0.5);">\n                <input type="checkbox" id="option_').concat(r,'" name="dl_video" value="').concat(r,'">\n                P').concat(r+1," ").concat(e.title(r+1),"\n            </div></label>");var c=!1;$("body").on("click","button#checkbox_btn",(function(){c?(c=!1,$('input[name="dl_video"]').prop("checked",c),$('input[name="dl_video"]').parent().css("color","rgba(0,0,0,0.5)")):(c=!0,$('input[name="dl_video"]').prop("checked",c),$('input[name="dl_video"]').parent().css("color","rgb(0,0,0)"))}));var l,s={120:"4K 超清",116:"1080P 60帧",112:"1080P 高码率",80:"1080P 高清",74:"720P 60帧",64:"720P 高清",48:"720P 高清(MP4)",32:"480P 清晰",16:"360P 流畅"},d="",u=D(a.get_quality_support());try{for(u.s();!(l=u.n()).done;){var p=l.value;d+='<option value="'.concat(p,'">').concat(s[p],"</option>")}}catch(e){u.e(e)}finally{u.f()}var f=""+'<div style="margin:2% 0;">\n            <label>视频格式：</label>\n            <select name="dl_format" id="dl_format">\n                <option value="flv" selected>FLV</option>\n                <option value="mp4">MP4</option>\n            </select>\n            &nbsp;&nbsp;仅video类型支持mp4\n        </div>\n        <div style="margin:2% 0;">\n            <label>视频质量：</label>\n            <select name="dl_quality" id="dl_quality">\n                '.concat(d,'\n            </select>\n        </div>\n        <div style="margin:2% 0;">\n            <label>下载字幕：</label>\n            <select name="dl_subtitle" id="dl_subtitle">\n                <option value="0" selected>关闭</option>\n                <option value="1">VTT</option>\n            </select>\n            &nbsp;&nbsp\n            <label>下载弹幕：</label>\n            <select name="dl_danmaku" id="dl_danmaku">\n                <option value="0" selected>关闭</option>\n                <option value="1">ASS</option>\n            </select>\n        </div>\n        <b>\n            <span style="color:red;">为避免请求被拦截，设置了延时且不支持下载无法播放的视频；请勿频繁下载过多视频，可能触发风控导致不可再下载！</span>\n        </b><br />\n        <div style="height:220px;width:100%;overflow:auto;background:rgba(0,0,0,0.1);">\n            ').concat(o,"\n        </div>\n        <div>").concat("medialist"===a.type()?"不支持多页视频，若需要请到视频原播放页面下载":"",'</div>\n        <div style="margin:2% 0;">\n            <button id="checkbox_btn">全选</button>\n        </div>');function v(e,t,n){if(e.length)if(t<e.length){var i=e[t];"1"===i.dl_subtitle&&Y.download_subtitle_vtt(i.p,i.filename),"1"===i.dl_danmaku&&Y.download_danmaku_ass(i.cid,i.filename);var o="第".concat(t+1,"（").concat(t+1,"/").concat(e.length,"）个视频");q("".concat(o,"：获取中...")),setTimeout((function(){le.get_urls(i.p,i.q,i.format,(function(a){if(!a.code){T("请求成功"+(a.times?"<br/>今日剩余请求次数".concat(a.times):"")),q("".concat(o,"：获取成功！"));var r=[a.url,X(a.url),H()],c=r[0],l=r[1],s=r[2];"post"===s?(n.push({url:c,filename:i.filename+l}),n.length>3&&(b(n),n.length=0)):"ariang"===s&&function(e){var t=window.bp_aria2_window,n=100;t&&!t.closed||(J(),n=3e3);setTimeout((function(){var t=window.bp_aria2_window,n="header=User-Agent:".concat(window.navigator.userAgent,"&header=Referer:").concat(window.location.href);if(t&&!t.closed){var i="#!/new/task?url=".concat(window.btoa(e.url),"&out=").concat(encodeURIComponent(e.filename),"&").concat(n);t.location.href="http://ariang.injahow.com/".concat(i),T("RPC请求成功")}else S("请检查RPC参数")}),n)}({url:c,filename:i.filename+l})}setTimeout((function(){v(e,++t,n)}),3e3)}),(function(){v(e,++t,n)}))}),3e3)}else q("视频地址请求完成！"),"post"===H()&&n.length>0&&(b(n),n.length=0)}function b(e){var t,n={domain:ne.rpc_domain,port:ne.rpc_port,token:ne.rpc_token,dir:ne.rpc_dir},i=[],o=D(e);try{for(o.s();!(t=o.n()).done;){var a=t.value;i.push({id:window.btoa("BParse_".concat(Date.now(),"_").concat(Math.random())),jsonrpc:"2.0",method:"aria2.addUri",params:["token:".concat(n.token),[a.url],{dir:n.dir,out:a.filename,header:["User-Agent: ".concat(window.navigator.userAgent),"Referer: ".concat(window.location.href)]}]})}}catch(e){o.e(e)}finally{o.f()}j("发送RPC下载请求"),A({url:"".concat(n.domain,":").concat(n.port,"/jsonrpc"),type:"POST",dataType:"json",data:JSON.stringify(i)}).then((function(e){e.length===i.length?T("RPC请求成功"):S("请检查RPC参数")})).catch((function(e){I("请检查RPC服务配置")}))}R(f,(function(){for(var t=$("#dl_quality").val()||n,o=$("#dl_subtitle").val(),a=$("#dl_danmaku").val(),r=[],c=0;c<i;c++)if($("input#option_".concat(c)).is(":checked")){var l=c+1,s=[e.cid(l),e.filename(l)],d=s[0],u=s[1],p=$("#dl_format").val();r.push({dl_subtitle:o,dl_danmaku:a,cid:d,p:l,q:t,format:p,filename:u})}v(r,0,[])})),$("#dl_quality").val(n>120?80:n)},download_danmaku_ass:function(e,t){A({url:"https://api.bilibili.com/x/v1/dm/list.so?oid=".concat(e),dataType:"text"}).then((function(e){var n=$(e.replace(/[\x00-\x08\x0b-\x0c\x0e-\x1f\x7f]/g,""));if(n&&n.find("d")[0]){var i=n.find("d").map((function(e,t){var n=$(t),i=n.attr("p").split(","),o=0;return"4"===i[1]?o=2:"5"===i[1]&&(o=1),[{time:parseFloat(i[0]),type:o,color:parseInt(i[3]),text:n.text()}]})).get();i.sort((function(e,t){return e.time-t.time}));var o,a=function(e,t,n){var i,o,a,r,c=e.text,l=e.time,s=[0===e.type?(o=50*(1+Math.floor(15*Math.random())),a=1920+50*e.text.length/2,r=0-50*e.text.length/2,"\\move(".concat(a,",").concat(o,",").concat(r,",").concat(o,")")):function(e,t){return"\\pos(".concat(t,",").concat(e,")")}(50*(1+n%15),960),(i=e.color,16777215===i?"":function(e){return"\\c&H".concat(((255&e)<<16|(e>>8&255)<<8|e>>16&255).toString(16),"&")}(e.color))],d=function(e){var t=function(e,t){return Math.floor(e/t)},n=function(e){return e<10?"0"+e:""+e},i=Math.floor(e),o=t(i,3600),a=t(i,60)%60,r=i%60,c=Math.floor(100*(e-i));return"".concat(o,":").concat(n(a),":").concat(n(r),".").concat(c)},u=[0,d(l),d(l+(0===e.type?8:4)),"Medium","","0","0","0","","{"+s.join("")+"}"+function(e){return e.replace(/\{/g,"｛").replace(/\}/g,"｝").replace(/\r|\n/g,"")}(c)];return"Dialogue: "+u.join(",")},r=["[Script Info]","; Script generated by bilibili-parse","; https://github.com/injahow/bilibili-parse","Title: ".concat(t),"ScriptType: v4.00+","PlayResX: ".concat(1920),"PlayResY: ".concat(1080),"Timer: 10.0000","WrapStyle: 2","ScaledBorderAndShadow: no","","[V4+ Styles]","Format: Name, Fontname, Fontsize, PrimaryColour, SecondaryColour, OutlineColour, BackColour, Bold, Italic, Underline, StrikeOut, ScaleX, ScaleY, Spacing, Angle, BorderStyle, Outline, Shadow, Alignment, MarginL, MarginR, MarginV, Encoding","Style: Small,微软雅黑,36,&H66FFFFFF,&H66FFFFFF,&H66000000,&H66000000,0,0,0,0,100,100,0,0,1,1.2,0,5,0,0,0,0","Style: Medium,微软雅黑,52,&H66FFFFFF,&H66FFFFFF,&H66000000,&H66000000,0,0,0,0,100,100,0,0,1,1.2,0,5,0,0,0,0","Style: Large,微软雅黑,64,&H66FFFFFF,&H66FFFFFF,&H66000000,&H66000000,0,0,0,0,100,100,0,0,1,1.2,0,5,0,0,0,0","Style: Larger,微软雅黑,72,&H66FFFFFF,&H66FFFFFF,&H66000000,&H66000000,0,0,0,0,100,100,0,0,1,1.2,0,5,0,0,0,0","Style: ExtraLarge,微软雅黑,90,&H66FFFFFF,&H66FFFFFF,&H66000000,&H66000000,0,0,0,0,100,100,0,0,1,1.2,0,5,0,0,0,0","","[Events]","Format: Layer, Start, End, Style, Name, MarginL, MarginR, MarginV, Effect, Text"],c=0,l=D(i);try{for(l.s();!(o=l.n()).done;){var s=o.value;0===s.type?0:c++,r.push(a(s,0,c))}}catch(e){l.e(e)}finally{l.f()}var d=URL.createObjectURL(new Blob([r.join("\n")],{type:"text/ass"})),u=document.createElement("a");u.style.display="none",u.href=d,u.download=t+".ass",document.body.appendChild(u),u.click(),u.remove(),URL.revokeObjectURL(d)}else S("未发现弹幕")})).catch((function(e){S("未发现字幕")}))},download_subtitle_vtt:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0,n=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(e){var n=document.createElement("a");n.setAttribute("target","_blank"),n.setAttribute("href",e),n.setAttribute("download",t+".vtt"),document.body.appendChild(n),n.click(),n.remove(),URL.revokeObjectURL(e)}else S("未发现字幕")};le.get_subtitle_url(e,n)},open_ariang:J},K=n(500),Q={};Q.styleTagTransform=m(),Q.setAttributes=v(),Q.insert=p().bind(null,"head"),Q.domAPI=d(),Q.insertStyleElement=_();l()(K.Z,Q);var ee=K.Z&&K.Z.locals?K.Z.locals:void 0,te='<div id="bp_config"> <div class="bp_config_bg"> <span style="font-size:20px"> <b>bilibili视频下载 参数设置</b> <b> <a href="javascript:;" onclick="bp_reset_config()"> [重置配置] </a> <a style="text-decoration:underline" href="javascript:;" onclick="bp_show_help()">&lt;通知&帮助&gt;</a> </b> </span> <div style="margin:2% 0"><label>请求地址：</label> <input id="base_api" value="..." style="width:30%">&nbsp;&nbsp;&nbsp;&nbsp; <label>请求方式：</label> <select id="request_type"> <option value="auto">自动判断</option> <option value="online">远程请求</option> <option value="local">本地请求</option> </select><br/> <small>注意：普通使用请勿修改；默认使用混合请求</small> </div> <div style="margin:2% 0"><label>视频格式：</label> <select id="format"> <option value="flv">FLV</option> <option value="dash">DASH</option> <option value="mp4">MP4</option> </select>&nbsp;&nbsp;&nbsp;&nbsp; <label>切换CDN：</label> <select id="host_key"> ${host_key_option} </select><br/> <small>注意：仅video支持MP4；建议特殊地区或网络受限时切换（自行选择合适线路）</small> </div> <div style="margin:2% 0"><label>下载方式：</label> <select id="download_type"> <option value="a">URL链接</option> <option value="web">Web浏览器</option> <option value="blob">Blob请求</option> <option value="rpc">RPC接口</option> <option value="aria">Aria命令</option> </select><br/> <small>提示：url和web方式下载不会设置文件名</small> </div> <div style="margin:2% 0"><label>RPC配置：[ 域名 : 端口 | 密钥 | 保存目录 ]</label><br/> <input id="rpc_domain" value="..." style="width:25%"> : <input id="rpc_port" value="..." style="width:10%"> | <input id="rpc_token" placeholder="没有密钥不用填" value="..." style="width:15%"> | <input id="rpc_dir" placeholder="留空使用默认目录" value="..." style="width:20%"><br/> <small>注意：RPC默认使用Motrix（需要安装并运行）下载，其他软件请修改参数</small> </div> <div style="margin:2% 0"> <label>强制换源：</label> <select id="replace_force"> <option value="0">关闭</option> <option value="1">开启</option> </select> &nbsp;&nbsp;&nbsp;&nbsp;<label>弹幕速度：</label> <input id="danmaku_speed" value="..." style="width:5%"> s &nbsp;&nbsp;&nbsp;&nbsp;<label>弹幕字号：</label> <input id="danmaku_fontsize" value="..." style="width:5%"> px <br/> <small>说明：使用请求到的视频地址在DPlayer进行播放；弹幕速度为弹幕滑过DPlayer的时间</small> </div> <div style="margin:2% 0"><label>自动下载：</label> <select id="auto_download"> <option value="0">关闭</option> <option value="1">开启</option> </select><br/> <small>说明：请求地址成功后将自动点击下载视频按钮</small> </div> <div style="margin:2% 0"><label>授权状态：</label> <select id="auth" disabled="disabled"> <option value="0">未授权</option> <option value="1">已授权</option> </select> <a class="setting-context" href="javascript:;" onclick="bp_show_login()">账号授权</a> <a class="setting-context" href="javascript:;" onclick="bp_show_logout()">取消授权</a> <a class="setting-context" href="javascript:;" onclick=\'bp_show_login("0")\'>手动授权</a> <a class="setting-context" href="javascript:;" onclick="bp_show_login_help()">这是什么？</a> </div> <div style="text-align:right"><br/> <button class="setting-button" onclick="bp_save_config()">确定</button> </div> </div> </div> ',ne={base_api:"https://api.injahow.cn/bparse/",request_type:"auto",format:"flv",host_key:"0",replace_force:"0",auth:"0",download_type:"web",rpc_domain:"http://localhost",rpc_port:"16800",rpc_token:"",rpc_dir:"D:/",auto_download:"0",danmaku_speed:"15",danmaku_fontsize:"22"},ie={ks3:"upos-sz-mirrorks3.bilivideo.com",ks3b:"upos-sz-mirrorks3b.bilivideo.com",ks3c:"upos-sz-mirrorks3c.bilivideo.com",ks32:"upos-sz-mirrorks32.bilivideo.com",kodo:"upos-sz-mirrorkodo.bilivideo.com",kodob:"upos-sz-mirrorkodob.bilivideo.com",cos:"upos-sz-mirrorcos.bilivideo.com",cosb:"upos-sz-mirrorcosb.bilivideo.com",bos:"upos-sz-mirrorbos.bilivideo.com",wcs:"upos-sz-mirrorwcs.bilivideo.com",wcsb:"upos-sz-mirrorwcsb.bilivideo.com",hw:"upos-sz-mirrorhw.bilivideo.com",hwb:"upos-sz-mirrorhwb.bilivideo.com",upbda2:"upos-sz-upcdnbda2.bilivideo.com",upws:"upos-sz-upcdnws.bilivideo.com",uptx:"upos-sz-upcdntx.bilivideo.com",uphw:"upos-sz-upcdnhw.bilivideo.com",js:"upos-tf-all-js.bilivideo.com",hk:"cn-hk-eq-bcache-01.bilivideo.com",akamai:"upos-hz-mirrorakam.akamaized.net"};function oe(){var e=Object.assign({},ne),n=t.get("config_str")||localStorage.getItem("my_config_str");if(n){var i=JSON.parse(n);for(var o in i)Object.hasOwnProperty.call(ne,o)&&(ne[o]=i[o])}else t.set("config_str",JSON.stringify(ne)),localStorage.setItem("my_config_str",JSON.stringify(ne));window.bp_save_config=function(){for(var e in ne)ne[e]=$("#".concat(e)).val();var n=JSON.parse(t.get("config_str")||localStorage.getItem("my_config_str"));t.set("config_str",JSON.stringify(ne)),localStorage.setItem("my_config_str",JSON.stringify(ne)),$("#bp_config").hide(),$("#bp_config").css("opacity",0),r.show();for(var i=0,o=["base_api","format","auth"];i<o.length;i++){var a=o[i];if(ne[a]!==n[a]){$("#video_download").hide(),$("#video_download_2").hide();break}}ne.host_key!==n.host_key&&(B.refresh(),$("#video_url").attr("href","#"),$("#video_url_2").attr("href","#")),ne.rpc_domain!==n.rpc_domain&&(ne.rpc_domain.match("https://")||ne.rpc_domain.match(/(localhost|127\.0\.0\.1)/)||q("检测到当前RPC不是localhost本地接口，即将跳转到AriaNg网页控制台页面；请查看控制台RPC接口参数是否正确，第一次加载可能较慢请耐心等待；配置好后即可使用脚本进行远程下载<br/>使用期间不用关闭控制台页面！",(function(){Y.open_ariang({domain:ne.rpc_domain,port:ne.rpc_port,token:ne.rpc_token})})));for(var c=0,l=["danmaku_speed","danmaku_fontsize"];c<l.length;c++){var s=l[c];if(ne[s]!==n[s]){M.danmaku.config();break}}},window.onbeforeunload=function(){window.bp_save_config();var e=window.bp_aria2_window;e&&!e.closed&&e.close()};var a=!1;for(var c in window.bp_show_help=function(){a?P():(a=!0,A({url:"".concat(ne.base_api,"/auth/v2/?act=help"),dataType:"text"}).then((function(e){e?q(e):S("获取失败")})).finally((function(e){return a=!1})))},!window.bp_reset_config&&(window.bp_reset_config=function(){for(var t in e)"auth"!==t&&$("#".concat(t)).val(e[t])}),te=te.replace("${host_key_option}",function(){for(var e=Object.keys(ie),t='<option value="0">关闭</option>',n=0,i=e;n<i.length;n++){var o=i[n];t+='<option value="'.concat(o,'">').concat(ie[o],"</option>")}return t}()),$("body").append(te+ee),ne)$("#".concat(c)).val(ne[c])}function ae(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return re(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return re(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,r=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return r=e.done,e},e:function(e){c=!0,a=e},f:function(){try{r||null==n.return||n.return()}finally{if(c)throw a}}}}function re(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function ce(e,n,i,o,r,c){"function"!=typeof o&&(o=function(e){return console.log(e)}),"function"!=typeof r&&(r=function(e){return console.error(e)});var l=a.base(),s=[l.aid(e),l.cid(e),l.epid(e),n||a.get_quality().q,l.type],d=s[0],u=s[1],p=s[2],f=s[3],v=s[4],b=i||ne.format;"mp4"===b&&"video"!==v&&(b="flv");var _,h=function(e){if("0"!==ne.host_key&&"online"===c&&"mp4"!==b){var t=e.split("/");t[2]=ie[ne.host_key],e=t.join("/")}return e},m={type:"GET",dataType:"json"};if("auto"===c||"local"===c){var y,g;"cheese"!==v?(_="https://api.bilibili.com/x/player/playurl","dash"===b?(y=0,g=80):(y=0,g=0)):(_="https://api.bilibili.com/pugv/player/web/playurl","dash"===b?(y=0,g=80):(y=1,g=80)),_+="?avid=".concat(d,"&cid=").concat(u,"&qn=").concat(f,"&fnver=").concat(y,"&fnval=").concat(g,"&fourk=1&ep_id=").concat(p,"&type=").concat(b,"&otype=json"),_+="mp4"===b?"&platform=html5&high_quality=1":"",m.xhrFields={withCredentials:!0}}else{_=ne.base_api,_+="?av=".concat(d,"&cid=").concat(u,"&q=").concat(f,"&ep=").concat(p,"&type=").concat(v,"&format=").concat(b,"&otype=json");var w=[t.get("auth_id"),t.get("auth_sec")],k=w[0],x=w[1];"1"===ne.auth&&k&&x&&(_+="&auth_id=".concat(k,"&auth_sec=").concat(x),e&&(_+="&s"))}m.url=_,A(m).then((function(t){var a;if(t.code||(a=t.result||t.data),!a)return"auto"===c?void ce(e,n,i,o,r,"online"):(t.url&&(t.url=h(t.url)),t.video&&(t.video=h(t.video)),t.audio&&(t.audio=h(t.audio)),void o(t));if(a.dash){for(var l={code:0,quality:a.quality,accept_quality:a.accept_quality,video:"",audio:""},s=a.dash.video,d=0;d<s.length;d++){var u=s[d];if(u.id<=f){l.video=h(u.base_url),l.audio=h(a.dash.audio[0].base_url);break}}o(l)}else o({code:0,quality:a.quality,accept_quality:a.accept_quality,url:h(a.durl[0].url)})})).catch((function(e){return r(e)}))}var le={get_url:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,i=ne.request_type,o=ne.format;ce(0,e,o,t,n,i)},get_urls:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0,a=ne.request_type;ce(e,t,n,i,o,a)},get_subtitle_url:function(e,t){var n=a.base(),i=[n.aid(e),n.cid(e),n.epid(e)],o=i[1],r=i[2];A({url:"https://api.bilibili.com/x/player/v2?aid=".concat(i[0],"&cid=").concat(o,"&ep_id=").concat(r),dataType:"json"}).then((function(e){!e.code&&e.data.subtitle.subtitles[0]?A({url:"".concat(e.data.subtitle.subtitles[0].subtitle_url),dataType:"json"}).then((function(e){var n,i="WEBVTT\n\n",o=ae(e.body||[{from:0,to:0,content:""}]);try{for(o.s();!(n=o.n()).done;){var a=n.value,r=new Date(1e3*(parseInt(a.from)-28800)).toTimeString().split(" ")[0]+"."+(a.from.toString().split(".")[1]||"000").padEnd(3,"0"),c=new Date(1e3*(parseInt(a.to)-28800)).toTimeString().split(" ")[0]+"."+(a.to.toString().split(".")[1]||"000").padEnd(3,"0");i+="".concat(r," --\x3e ").concat(c,"\n").concat(a.content.trim(),"\n\n")}}catch(e){o.e(e)}finally{o.f()}t(URL.createObjectURL(new Blob([i],{type:"text/vtt"})))})).catch(t):t()})).catch(t)},get_season:function(e){A({url:"https://api.bilibili.com/pugv/view/web/season?ep_id=".concat(e),xhrFields:{withCredentials:!0},dataType:"json"}).then((function(e){e.code?S("获取剧集信息失败"):window.bp_episodes=e.data.episodes||null}))}};function se(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var de=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.is_login=!1,this.vip_status=0,this.mid="",this.uname="",this.has_init=!1,this.lazyInit()}var t,n,i;return t=e,(n=[{key:"needReplace",value:function(){return!this.is_login||!this.vip_status&&a.base().need_vip()}},{key:"lazyInit",value:function(e){this.has_init||(window.__BILI_USER_INFO__?(this.is_login=window.__BILI_USER_INFO__.isLogin,this.vip_status=window.__BILI_USER_INFO__.vipStatus,this.mid=window.__BILI_USER_INFO__.mid||"",this.uname=window.__BILI_USER_INFO__.uname||""):window.__BiliUser__&&(this.is_login=window.__BiliUser__.isLogin,window.__BiliUser__.cache?(this.vip_status=window.__BiliUser__.cache.data.vipStatus,this.mid=window.__BiliUser__.cache.data.mid||"",this.uname=window.__BiliUser__.cache.data.uname||""):(this.vip_status=0,this.mid="",this.uname="")),this.has_init=e)}}])&&se(t.prototype,n),i&&se(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}());function ue(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var pe=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.auth_clicked=!1}var n,i,o;return n=e,i=[{key:"reLogin",value:function(){t.set("auth_id",""),t.set("auth_sec",""),t.set("access_key",""),t.set("auth_time","0"),this.login()}},{key:"checkLoginStatus",value:function(){var e=this,n=[t.get("auth_id"),t.get("auth_sec"),t.get("access_key"),t.get("auth_time")||"0"],i=n[0],o=n[1],a=n[2],r=n[3];a&&(de.is_login&&(ne.base_api!==t.get("pre_base_api")||Date.now()-parseInt(r)>864e5)&&A({url:"https://api.bilibili.com/x/space/myinfo?access_key=".concat(a),type:"GET",dataType:"json"}).then((function(n){if(!n.code)return t.set("auth_time",Date.now()),A({url:"".concat(ne.base_api,"/auth/v2/?act=check&auth_id=").concat(i,"&auth_sec=").concat(o,"&access_key=").concat(a),type:"GET",dataType:"json"});q("授权已过期，准备重新授权",e.reLogin)})).then((function(t){t.code&&q("授权检查失败，准备重新授权",e.reLogin)})),t.set("pre_base_api",ne.base_api))}},{key:"_login",value:function(e){var t=this;this.auth_clicked?P():(this.auth_clicked=!0,A({url:"https://passport.bilibili.com/login/app/third?appkey=27eb53fc9058f8c3&api=https%3A%2F%2Fwww.mcbbs.net%2Ftemplate%2Fmcbbs%2Fimage%2Fspecial_photo_bg.png&sign=04224646d1fea004e79606d3b038c84a",xhrFields:{withCredentials:!0},type:"GET",dataType:"json"}).then(e).finally((function(e){return t.auth_clicked=!1})))}},{key:"login",value:function(){_login((function(e){e.data.has_login?$("body").append("<iframe id='auth_iframe' src='".concat(e.data.confirm_uri,"' style='display:none;'></iframe>")):R("必须登录B站才能正常授权，是否登陆？",(function(){location.href="https://passport.bilibili.com/login"}))}))}},{key:"loginManual",value:function(){_login((function(e){if(e.data.has_login){var n=""+"请点击<b><a href='".concat(e.data.confirm_uri,"' target='_blank'>授权地址</a></b>\n                    打开一个新窗口，正常情况新窗口应该显示一个图片，请将该窗口地址栏的URL链接复制到当前文本框中<br/>\n                    <input id='auth_url' style='width:100%;' type='text' autocomplete='off'><br>然后点击确定即可");q(n,(function(){var e=$("#auth_url").val(),n=t.get("auth_id")||"",i=t.get("auth_sec")||"";A({url:e.replace("https://www.mcbbs.net/template/mcbbs/image/special_photo_bg.png?","".concat(ne.base_api,"/auth/v2/?act=login&auth_id=").concat(n,"&auth_sec=").concat(i,"&")),type:"GET",dataType:"json"}).then((function(n){n.code?S("授权失败"):(T("授权成功"),n.auth_id&&n.auth_sec&&(t.set("auth_id",n.auth_id),t.set("auth_sec",n.auth_sec)),t.set("access_key",new URL(e).searchParams.get("access_key")),t.set("auth_time",Date.now()),$("#auth").val("1"),ne.auth="1")}))}))}else R("必须登录B站才能正常授权，是否登陆？",(function(){location.href="https://passport.bilibili.com/login"}))}))}},{key:"logout",value:function(){var e=this;if(t.get("auth_id"))if(this.auth_clicked)P();else{var n=[t.get("auth_id"),t.get("auth_sec")],i=n[0],o=n[1];A({url:"".concat(ne.base_api,"/auth/v2/?act=logout&auth_id=").concat(i,"&auth_sec=").concat(o),type:"GET",dataType:"json"}).then((function(e){e.code?S("取消失败"):(T("取消成功"),t.set("auth_id",""),t.set("auth_sec",""),t.set("auth_time","0"),t.set("access_key",""),$("#auth").val("0"),ne.auth="0")})).finally((function(t){return e.auth_clicked=!1}))}else q("没有发现授权记录")}},{key:"initAuth",value:function(){var e=this;window.bp_show_login=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"1",i=function(){"1"===n?e.login():e.loginManual()};t.get("auth_id")?R("发现授权记录，是否重新授权？",(function(){i()})):i()},window.bp_show_logout=function(){e.logout()},window.bp_show_login_help=function(){R("进行授权之后将能在远程请求时享有用户账号原有的权益，例如能够请求用户已经付费或承包的番剧，是否需要授权？",(function(){e.login()}))},window.addEventListener("message",(function(n){if("string"==typeof n.data&&"bilibili-parse-login-credentials"===n.data.split(":")[0]){$("iframe#auth_iframe").remove();var i=n.data.split(": ")[1],o=[t.get("auth_id"),t.get("auth_sec")],a=o[0],r=o[1];A({url:i.replace("https://www.mcbbs.net/template/mcbbs/image/special_photo_bg.png?","".concat(ne.base_api,"/auth/v2/?act=login&auth_id=").concat(a,"&auth_sec=").concat(r,"&")),type:"GET",dataType:"json"}).then((function(e){e.code?S("授权失败"):(T("授权成功"),e.auth_id&&e.auth_sec&&(t.set("auth_id",e.auth_id),t.set("auth_sec",e.auth_sec)),t.set("access_key",new URL(i).searchParams.get("access_key")),t.set("auth_time",Date.now()),$("#auth").val("1"),ne.auth="1")})).finally((function(t){return e.auth_clicked=!1}))}}))}}],i&&ue(n.prototype,i),o&&ue(n,o),Object.defineProperty(n,"prototype",{writable:!1}),e}(),fe=new pe;function ve(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var be=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),window.bp_fun_locked||(window.bp_fun_locked=!0,null==location.href.match(/^https:\/\/www\.mcbbs\.net\/template\/mcbbs\/image\/special_photo_bg\.png/)?$(".error-text")[0]||(oe(),$("body").append('<div class="message-bg"></div> <div id="message_box"> <div class="message_box_bg"> <span style="font-size:20px"><b>提示：</b></span> <div id="message_box_context" style="margin:2% 0">...</div><br/><br/> <div class="message_box_btn"> <button class="setting-button" name="affirm">确定</button> <button class="setting-button" name="cancel">取消</button> </div> </div> </div> '+w),fe.initAuth()):location.href.match("access_key")&&window!==window.parent&&(window.stop(),window.parent.postMessage("bilibili-parse-login-credentials: "+location.href,"*")))}var n,i,o;return n=e,i=[{key:"run",value:function(){var e,n;$("body").append('<a id="video_url" style="display:none;" target="_blank" referrerpolicy="origin" href="#"></a>'),$("body").append('<a id="video_url_2" style="display:none;" target="_blank" referrerpolicy="origin" href="#"></a>'),setTimeout((function(){var e;$("#arc_toolbar_report")[0]?(e='<div id="arc_toolbar_report_2" style="margin-top:16px" class="video-toolbar report-wrap-module report-scroll-module" scrollshow="true"> <div class="ops"> <span id="setting_btn"><i class="van-icon-general_addto_s"></i>脚本设置</span> <span id="bilibili_parse"><i class="van-icon-floatwindow_custome"></i>请求地址</span> <span id="video_download" style="display:none"><i class="van-icon-download"></i>下载视频</span> <span id="video_download_2" style="display:none"><i class="van-icon-download"></i>下载音频</span> <span id="video_download_all"><i class="van-icon-download"></i>批量下载</span> </div> <div class="more"> <i class="van-icon-general_moreactions"></i> <div class="more-ops-list"> <ul> <li><span id="download_danmaku">下载弹幕</span></li> <li><span id="download_subtitle">下载字幕</span></li> </ul> </div> </div> </div> ',$("#arc_toolbar_report").after(e)):$("#toolbar_module")[0]?(e='<div id="toolbar_module_2" class="tool-bar clearfix report-wrap-module report-scroll-module media-info" scrollshow="true"> <div id="setting_btn" class="like-info"> <i class="iconfont icon-add"></i><span>脚本设置</span> </div> <div id="bilibili_parse" class="like-info"> <i class="iconfont icon-customer-serv"></i><span>请求地址</span> </div> <div id="video_download" class="like-info" style="display:none"> <i class="iconfont icon-download"></i><span>下载视频</span> </div> <div id="video_download_2" class="like-info" style="display:none"> <i class="iconfont icon-download"></i><span>下载音频</span> </div> <div id="video_download_all" class="like-info"> <i class="iconfont icon-download"></i><span>批量下载</span> </div> <div class="more">更多<div class="more-ops-list"> <ul> <li><span id="download_danmaku">下载弹幕</span></li> <li><span id="download_subtitle">下载字幕</span></li> </ul> </div> </div> <style>.tool-bar .more{float:right;cursor:pointer;color:#757575;font-size:16px;display:inline-block;transition:all .3s;position:relative;text-align:center}.tool-bar .more:hover .more-ops-list{display:block}.tool-bar:after{display:block;content:"";clear:both}.more-ops-list{display:none;position:absolute;width:80px;left:-65px;z-index:30;text-align:center;padding:10px 0;background:#fff;border:1px solid #e5e9ef;box-shadow:0 2px 4px 0 rgba(0,0,0,.14);border-radius:2px;font-size:14px;color:#222}.more-ops-list li{position:relative;height:34px;line-height:34px;cursor:pointer;transition:all .3s}.more-ops-list li:hover{color:#00a1d6;background:#e7e7e7}</style> </div> ',$("#toolbar_module").after(e)):$("div.video-toolbar")[0]&&(e='<div id="arc_toolbar_report_2" style="margin-top:16px" class="video-toolbar report-wrap-module report-scroll-module" scrollshow="true"> <div class="ops"> <span id="setting_btn"><i class="van-icon-general_addto_s"></i>脚本设置</span> <span id="bilibili_parse"><i class="van-icon-floatwindow_custome"></i>请求地址</span> <span id="video_download" style="display:none"><i class="van-icon-download"></i>下载视频</span> <span id="video_download_2" style="display:none"><i class="van-icon-download"></i>下载音频</span> <span id="video_download_all"><i class="van-icon-download"></i>批量下载</span> </div> <div class="more"> <i class="van-icon-general_moreactions"></i> <div class="more-ops-list"> <ul class="more-ops-list-box"> <li class="more-ops-list-box-li"><span id="download_danmaku">下载弹幕</span></li> <li class="more-ops-list-box-li"><span id="download_subtitle">下载字幕</span></li> </ul> </div> </div> </div> ',$("div.video-toolbar").after(e)),de.lazyInit(),fe.checkLoginStatus(),B.refresh()}),3e3),$("body").on("click","#setting_btn",(function(){for(var e in de.lazyInit(!0),ne)$("#".concat(e)).val(ne[e]);$("#bp_config").show(),$("#bp_config").animate({opacity:"1"},300),r.hide()})),$("body").on("click","#download_danmaku",(function(){var e=a.base();Y.download_danmaku_ass(e.cid(),e.filename())})),$("body").on("click","#download_subtitle",(function(){Y.download_subtitle_vtt(0,a.base().filename())})),$("body").on("click","#video_download_all",(function(){de.lazyInit(!0),t.get("auth_id")&&t.get("auth_sec")?"rpc"===ne.download_type?Y.download_all():R("仅支持使用RPC接口批量下载，请确保RPC环境正常，是否继续？",(function(){Y.download_all()})):R("批量下载仅支持授权用户使用RPC接口下载，是否进行授权？",(function(){window.bp_show_login()}))})),$("body").on("click","#video_download",(function(){var e=ne.download_type;if("web"===e)$("#video_url")[0].click();else if("a"===e){var t=[$("#video_url").attr("href"),$("#video_url_2").attr("href")],n=t[1],i="建议使用IDM、FDM等软件安装其浏览器插件后，鼠标右键点击链接下载~<br/><br/>"+'<a href="'.concat(t[0],'" target="_blank" style="text-decoration:underline;">&gt视频地址&lt</a><br/><br/>')+("dash"===ne.format?'<a href="'.concat(n,'" target="_blank" style="text-decoration:underline;">&gt音频地址&lt</a>'):"");q(i)}else if("aria"===e){var o,r,c=[$("#video_url").attr("href"),$("#video_url_2").attr("href")],l=c[0],s=c[1],d=a.base().filename();o=d+Y.url_format(l),r=d+"_audio.mp4";var u='--header "User-Agent: '.concat(window.navigator.userAgent,'" --header "Referer: ').concat(window.location.href,'"'),p='aria2c "'.concat(l,'" --out "').concat(o,'" ').concat(u),f='aria2c "'.concat(s,'" --out "').concat(r,'" ').concat(u),v="点击文本框即可复制下载命令！<br/><br/>"+'视频：<br/><input id="aria2_code" value=\''.concat(p,'\' onclick="bp_clip_btn(\'aria2_code\')" style="width:100%;"></br></br>')+("dash"===ne.format?'音频：<br/><input id="aria2_code_2" value=\''.concat(f,'\' onclick="bp_clip_btn(\'aria2_code_2\')" style="width:100%;"><br/><br/>')+'全部：<br/><textarea id="aria2_code_all" onclick="bp_clip_btn(\'aria2_code_all\')" style="min-width:100%;max-width:100%;min-height:100px;max-height:100px;">'.concat(p,"\n").concat(f,"</textarea>"):"");!window.bp_clip_btn&&(window.bp_clip_btn=function(e){$("#".concat(e)).select(),document.execCommand("copy")?T("复制成功"):S("复制失败")}),q(v)}else{var b=$("#video_url").attr("href"),_=a.base().filename();Y.download(b,_,e)}})),$("body").on("click","#video_download_2",(function(){var e=ne.download_type;if("web"===e)$("#video_url_2")[0].click();else if("a"===e)$("#video_download").click();else if("aria"===e)$("#video_download").click();else{var t=$("#video_url_2").attr("href"),n=a.base().filename();Y.download(t,n,e)}})),$("body").on("click","#bilibili_parse",(function(){de.lazyInit(!0);var i=a.base(),o=[i.type,i.aid(),i.p(),i.cid(),i.epid()],r=o[0],c=o[1],l=o[2],s=o[3],d=o[4],u=a.get_quality().q;e="".concat(ne.base_api,"?av=").concat(c,"&p=").concat(l,"&cid=").concat(s,"&ep=").concat(d,"&q=").concat(u,"&type=").concat(r,"&format=").concat(ne.format,"&otype=json&_host=").concat(ne.host_key,"&_req=").concat(ne.request_type);var p=[t.get("auth_id"),t.get("auth_sec")],f=p[0],v=p[1];if("1"===ne.auth&&f&&v&&(e+="&auth_id=".concat(f,"&auth_sec=").concat(v)),e!==n||"local"===ne.request_type)$("#video_url").attr("href","#"),$("#video_url_2").attr("href","#"),n=e,j("开始请求"),le.get_url(0,(function(e){if(e&&!e.code){T("请求成功"),e.times&&j("剩余请求次数：".concat(e.times));var t="dash"===ne.format?e.video.replace("http://","https://"):e.url.replace("http://","https://"),n="dash"===ne.format?e.audio.replace("http://","https://"):"#";$("#video_url").attr("href",t),$("#video_download").show(),"dash"===ne.format&&($("#video_url_2").attr("href",n),$("#video_download_2").show()),(de.needReplace()||i.is_limited()||"1"===ne.replace_force)&&M.replace_player(t,n),"1"===ne.auto_download&&$("#video_download").click()}}));else{P();var b=$("#video_url").attr("href"),_=$("#video_url_2").attr("href");b&&"#"!==b&&($("#video_download").show(),"dash"===ne.format&&$("#video_download_2").show(),(de.needReplace()||i.is_limited()||"1"===ne.replace_force)&&!$("#bp_dplayer")[0]&&M.recover_player(b,_),"1"===ne.auto_download&&$("#video_download").click())}})),$("body").on("click","a.router-link-active",(function(){this!==$('li[class="on"]').find("a")[0]&&B.refresh()})),$("body").on("click","li.ep-item",(function(){B.refresh()})),$("body").on("click","button.bilibili-player-iconfont-next",(function(){B.refresh()}));var i=M.bili_video_tag();$(i)[0]&&($(i)[0].onended=function(){B.refresh()}),$("body").on("click","li.bui-select-item",(function(){B.refresh()})),setInterval((function(){(B.q!==a.get_quality().q||"cheese"===a.type()&&B.epid!==a.base().epid())&&B.refresh()}),1e3),$("body").on("click",".rec-list",(function(){B.refresh()})),$("body").on("click",".bilibili-player-ending-panel-box-videos",(function(){B.refresh()})),setInterval((function(){var e=a.base();B.aid===e.aid()&&B.cid===e.cid()||B.refresh()}),3e3)}}],i&&ve(n.prototype,i),o&&ve(n,o),Object.defineProperty(n,"prototype",{writable:!1}),e}(),_e=be;console.log("\n".concat(" %c bilibili-parse-download.user.js v","2.0.0"," ").concat("33979c4"," %c https://github.com/injahow/user.js ","\n","\n"),"color: #fadfa3; background: #030307; padding:5px 0;","background: #fadfa3; padding:5px 0;"),(new _e).run()}()}();