# bilibili 视频下载

_注意：此脚本只在视频、番剧、电影、电视剧播放页面（包含/av\*、/BV\*、/ep\*、/ss\*等）、用户收藏（含稍后再看）播放页面、课程视频播放页面，显示操作按钮！_

如果网络环境特殊（港澳台等），使用前请在脚本设置自行选择合适 CDN，否则可能无法播放和下载部分视频

## 使用方法

首先打开特定播放页面，脚本运行后，等待几秒后页面会出现如图所示操作按钮，如果没有请刷新页面

![1.md.png](https://img.injahow.com/images/2021/08/20/1.md.png)

当脚本运行成功出现操作按钮后，点击 **请求地址** 即可获取视频地址，视频分辨率与用户当前播放器选择的分辨率一致

点击 **请求地址** 后，脚本首先会自行判断是否需要换源播放，随后会显示如图 **下载视频** 按钮

![1.5.md.png](https://img.injahow.com/images/2021/08/20/1.5.md.png)

直接点击 **下载视频** 脚本就会按照设置中选择的方式弹出提示或下载当前视频

脚本设置界面如图，修改设置之前请确认你知道自己在干什么

![2.md.png](https://img.injahow.com/images/2021/08/13/2.md.png)

此外脚本内置了一套弹窗组件，分为自动消失的用户请求反馈提示框和用户交互使用的对话框

比如，如果你不停点击 **请求地址** 按钮会出现 **(^・ω・^)~喵喵喵~** 的提示，简称一键三喵，提示你手抽筋了

## 使用建议

1. 浏览器建议使用 chrome、firefox、edge 等主流浏览器，浏览器版本尽量使用较新版本，其他浏览器兼容性未知

2. 第一次使用脚本会弹出授权提示，主要是用于下载高码率视频或会员付费视频，在设置页面可以随时更改授权信息

3. 脚本支持 URL、Web、RPC、Blob、Aria 下载方式（注意：使用前两个方式下载不会设置文件名称）

   1. **URL 链接下载**：就是显示 a 标签，你可以点击下载或右键使用 IDM、FDM 等软件的浏览器插件下载
   2. **Web 浏览器下载**：同上，也是 a 标签点击下载，只是不会显示链接直接下载，可结合 IDM 等下载插件拦截下载请求（IDM 需要添加对 FLV 格式的支持）
   3. **RPC 下载**：需要你有支持 RPC 接口的下载软件，脚本默认使用的是 Motrix 软件的接口，请下载 Motrix 并运行后使用，注：此下载方式出错概率极低，优先推荐用户使用 （注意浏览器策略原因导致无法发送请求到 http 域名，已使用 AriaNg 解决）
   4. **Blob 请求**：是使用浏览器下载，只是下载过程无法在浏览器下载栏查看，当任务下载完成后浏览器才会出现保存提示，期间不能随便操作浏览器，建议用于下载较小的视频
   5. **Aria 命令**：需要使用 Aria2 软件下载，可以直接使用 Aria2 或使用支持 Aria2 命令的下载软件下载，比如 xDown

4. 脚本支持播放和下载 flv、dash、mp4 视频格式；（注意：番剧不支持 mp4 请求会重定向为 flv，如果需要 mp4 可以使用 dash 源合并处理）

   1. 浏览器不支持 flv 在线播放，故使用了 flv.js 脚本进行播放，但如果进度条直接拖拽到播放器未缓冲的部分可能会导致视频卡顿，需要等待缓冲后右调进度条才可正常播放
   2. dash 可以直接播放，进度条可直接拖拽，貌似不会出现卡顿现象，故推荐 dash 作为换源播放的请求，但由于 dplayer 好像不支持音视频同时加载播放，我只好创建了两个播放器，然后绑定了几个事件，一般情况下播放不会出现问题，如果出现音视频不同步，可以用鼠标拖拽或点击进度条进行调整

5. 脚本运行不正常时，可以尝试刷新页面或在设置里重置配置，如果问题无法解决请提交反馈

6. 反馈问题时请尽量携带具体运行环境，例如脚本运行的网页、配置信息、用户的操作或截图等，有能力者可查看浏览器控制台，看看是否出现脚本代码运行错误的提示等

## 常见问题

### 1.视频无法下载？

- 首先，请确认你当前使用的网络环境，如果是特殊地区（港澳台等）请在脚本设置 **切换 CDN** 使用相应 CDN 更改视频地址

- 请先确认当前设置使用的 **下载方式** ，如图为 RPC 接口

  ![3.png](https://img.injahow.com/images/2021/08/13/3.png)

- 部分浏览器无法使用 web 浏览器方式下载，可能没有安装下载插件或其他原因，如果 web 方式无法下载而且视频不大可尝试 blob 方式下载，还是不行就直接使用 RPC 接口用 Motrix 下载，还是不行，请反馈问题

### 2.下载的文件打不开？

- 请先确认当前设置使用的 **视频格式** ，如图为 flv 格式

  ![4.png](https://img.injahow.com/images/2021/08/13/4.png)

- 脚本默认为 flv 选项，下载 flv 格式的视频（低分辨率视频会下载 mp4 文件），需要使用支持 flv 视频的播放器才可以打开，你也可以使用 ffmpeg 之类的软件将其转码为 mp4 格式，也可以直接使用 FDM （内置 ffmpeg 工具）转码为 mp4 格式

- 此外 dash 选项是和网站原生播放器播放的相同格式，为音视频分离格式，文件后缀为 m4s，可以直接改为 mp4 播放，建议可将音视频文件均下载后使用 ffmpeg 直接合并为 mp4 文件

- 最后 MP4 格式，视频清晰度有限默认下载最大分辨率，一般没什么问题

### 3.换源播放失败？

- 同样，请确认你当前使用的网络环境，如果是特殊地区（港澳台等）请在脚本设置 **切换 CDN** 使用相应 CDN 更改视频地址

- 请先尝试修改设置，使用不同的 **视频格式** 请求地址，如果都不能播放可反馈问题

- dash 视频源存在 ip 限制，请注意当前网络代理情况，flv 视频源还没发现限制应该可以正常播放；如果可以播放但视频缓冲速度过慢，建议下载后观看

## 附录

### 软件下载

- [Motrix：https://motrix.app/](https://motrix.app/)

- [FDM：https://www.freedownloadmanager.org/zh/download.htm](https://www.freedownloadmanager.org/zh/download.htm)

- [Aria2：https://aria2.github.io/](https://aria2.github.io/)

- [xDown：https://xdown.org/](https://xdown.org/)

- [FFmpeg：https://ffmpeg.org/download.html](https://ffmpeg.org/download.html)
